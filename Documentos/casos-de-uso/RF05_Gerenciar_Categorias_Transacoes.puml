@startuml RF05_Gerenciar_Categorias_Transacoes
!theme plain

' Configura√ß√£o de cores
skinparam actor {
    BackgroundColor #87CEEB
    BorderColor #4682B4
}

skinparam usecase {
    BackgroundColor #98FB98
    BorderColor #228B22
}

skinparam note {
    BackgroundColor #FFFACD
    BorderColor #DAA520
}

skinparam package {
    BackgroundColor #F5F5F5
    BorderColor #696969
}

left to right direction

actor "Usu√°rio Autenticado" as User

package "Sistema de Gest√£o Financeira" {
    
    usecase (Main) "UC-05: Gerenciar Categorias de Transa√ß√µes" as UC_Main
    
    ' Fluxo principal
    usecase (1) "Acessar P√°gina de Categorias" as UC_Access
    usecase (2) "Visualizar Categorias" as UC_View
    usecase (3) "Abrir Formul√°rio de Nova Categoria" as UC_OpenForm
    usecase (4) "Preencher Dados da Categoria" as UC_Fill
    usecase (5) "Validar Dados da Categoria" as UC_Validate
    usecase (6) "Salvar Categoria" as UC_Save
    usecase (7) "Disponibilizar Categoria para Uso" as UC_MakeAvailable
    usecase (8) "Exibir Confirma√ß√£o de Sucesso" as UC_Confirm
    
    ' Tipos de categorias
    usecase (D) "Categorias Padr√£o" as UC_Default
    usecase (C) "Categorias Personalizadas" as UC_Custom
    
    ' Campos do formul√°rio
    usecase (N) "Informar Nome" as UC_Name
    usecase (T) "Selecionar Tipo" as UC_Type
    usecase (I) "Selecionar √çcone" as UC_Icon
    usecase (CL) "Selecionar Cor" as UC_Color
    usecase (DS) "Informar Descri√ß√£o" as UC_Description
    
    ' Tipos de categoria
    usecase (R) "Tipo: Receita" as UC_IncomeType
    usecase (E) "Tipo: Despesa" as UC_ExpenseType
    usecase (B) "Tipo: Ambos" as UC_BothType
    
    ' Opera√ß√µes dispon√≠veis
    usecase (CR) "Criar Categoria" as UC_Create
    usecase (ED) "Editar Categoria" as UC_Edit
    usecase (DL) "Excluir Categoria" as UC_Delete
    
    ' Fluxo secund√°rio
    usecase (FS1) "Nome Duplicado" as UC_DuplicateName
    usecase (FS1a) "Exibir Erro: Nome J√° Existente" as UC_ErrorDuplicate
    usecase (FS1b) "Retornar ao Formul√°rio" as UC_ReturnForm
end note
    
    ' Valida√ß√µes espec√≠ficas
    usecase (V1) "Validar Nome N√£o Vazio" as UC_CheckName
    usecase (V2) "Validar Nome √önico para o Usu√°rio" as UC_CheckUniqueName
    usecase (V3) "Validar Tipo Selecionado" as UC_CheckType
}

' Fluxo principal
User --> UC_Access
UC_Access --> UC_Main
UC_Main --> UC_View : "1. Sistema exibe categorias"
UC_View --> UC_Default : <<extend>> "padr√£o"
UC_View --> UC_Custom : <<extend>> "personalizadas"
UC_View --> UC_OpenForm : "2. Usu√°rio pode criar nova categoria"
UC_OpenForm --> UC_Fill : "3. Usu√°rio preenche formul√°rio"
UC_Fill --> UC_Validate : "4. Sistema valida dados"
UC_Validate --> UC_Save : "valida√ß√£o OK"
UC_Save --> UC_MakeAvailable : "5. Sistema disponibiliza categoria"
UC_MakeAvailable --> UC_Confirm : "6. Sistema exibe confirma√ß√£o"

' Tipos de categorias visualizadas
UC_View --> UC_Default : <<include>>
UC_View --> UC_Custom : <<include>>

' Campos do formul√°rio
UC_Fill --> UC_Name : <<include>>
UC_Fill --> UC_Type : <<include>>
UC_Fill --> UC_Icon : <<include>>
UC_Fill --> UC_Color : <<include>>
UC_Fill --> UC_Description : <<include>>

' Tipos de categoria dispon√≠veis
UC_Type --> UC_IncomeType : "Receita"
UC_Type --> UC_ExpenseType : "Despesa"
UC_Type --> UC_BothType : "Ambos (Receita e Despesa)"

' Opera√ß√µes
UC_View --> UC_Create : <<extend>>
UC_View --> UC_Edit : <<extend>>
UC_View --> UC_Delete : <<extend>>

' Valida√ß√µes
UC_Validate --> UC_CheckName : <<include>>
UC_Validate --> UC_CheckUniqueName : <<include>>
UC_Validate --> UC_CheckType : <<include>>

' Fluxo secund√°rio 1: Nome duplicado
UC_CheckUniqueName --> UC_DuplicateName : "se nome j√° existe"
UC_DuplicateName --> UC_ErrorDuplicate
UC_ErrorDuplicate --> UC_ReturnForm : "retorna ao passo 3"
UC_ReturnForm --> UC_OpenForm

note right of UC_Main
  **REQUISITO FUNCIONAL RF-05**
  **Gerenciar Categorias de Transa√ß√µes**
  
  ===== DESCRI√á√ÉO =====
  O sistema permite criar, editar e gerenciar
  categorias para organizar transa√ß√µes
  financeiras.
  
  ===== ATOR =====
  Usu√°rio autenticado
  
  ===== PRIORIDADE =====
  Importante
  
  ===== PR√â-CONDI√á√ïES =====
  - Usu√°rio autenticado
  - Usu√°rio informar dados da categoria:
    * Nome
    * Descri√ß√£o (opcional)
    * √çcone
    * Cor
    * Tipo (receita/despesa/ambos)
  
  ===== P√ìS-CONDI√á√ïES =====
  - Categoria √© criada/editada com sucesso
  - Categoria fica dispon√≠vel para uso
    em transa√ß√µes
  - Categoria aparece na lista de
    categorias
end note

note bottom of UC_CheckUniqueName
  **FLUXO SECUND√ÅRIO FS-1**
  **Nome Duplicado**
  
  No fluxo principal passo 4, se j√° existir
  uma categoria com o mesmo nome para o
  usu√°rio:
  
  1. Sistema exibe mensagem de erro:
     "J√° existe uma categoria com este nome"
  2. Sistema retorna ao passo 3 (formul√°rio)
  3. Usu√°rio deve escolher um nome diferente
     e tentar novamente
  
  **Valida√ß√£o:**
  - Implementada via unique_together no
    banco de dados: [name, user]
  - Cada usu√°rio pode ter apenas uma
    categoria com determinado nome
  - Categorias padr√£o do sistema n√£o
    afetam as personalizadas
end note

note left of UC_Default
  **Categorias Padr√£o**
  
  - S√£o fornecidas pelo sistema
  - Sempre vis√≠veis para todos os usu√°rios
  - N√£o podem ser editadas ou exclu√≠das
  - Exemplos: Alimenta√ß√£o, Transporte, Sal√°rio
  - Caracter√≠stica: is_default = True
end note

note left of UC_Custom
  **Categorias Personalizadas**
  
  - Criadas pelo pr√≥prio usu√°rio
  - Podem ser editadas e exclu√≠das
  - N√£o podem ter nomes duplicados
  - Ficam dispon√≠veis apenas para o usu√°rio
  - Caracter√≠stica: is_default = False
end note

note right of UC_IncomeType
  **Tipo: Receita**
  
  Categoria para transa√ß√µes de receita:
  - Sal√°rios
  - Vendas
  - Investimentos
  - Renda extra
  
  Uso apenas em transa√ß√µes de entrada
end note

note right of UC_ExpenseType
  **Tipo: Despesa**
  
  Categoria para transa√ß√µes de despesa:
  - Alimenta√ß√£o
  - Moradia
  - Sa√∫de
  - Educa√ß√£o
  
  Uso apenas em transa√ß√µes de sa√≠da
end note

note right of UC_BothType
  **Tipo: Ambos**
  
  Categoria flex√≠vel para receitas e
  despesas:
  
  - Pode ser usada em ambos os tipos
    de transa√ß√£o
  - √ötil para categorias gen√©ricas
  - Permite flexibilidade na organiza√ß√£o
  
  Uso em qualquer tipo de transa√ß√£o
end note

note right of UC_Icon
  **Sele√ß√£o de √çcone**
  
  - Usu√°rio pode escolher √≠cone visual
    para identificar categoria
  - √çcones melhoram a experi√™ncia visual
  - Exemplos: üè† üçï üíä üìö üí∞
  - Campo opcional com valor padr√£o
end note

note right of UC_Color
  **Sele√ß√£o de Cor**
  
  - Usu√°rio escolhe cor em hexadecimal
    (#RRGGBB)
  - Cor √© usada na interface para
    identifica√ß√£o visual
  - Padr√£o: #3b82f6 (azul)
  - Exemplos: #ef4444 (vermelho),
    #10b981 (verde), #f59e0b (laranja)
end note

note right of UC_MakeAvailable
  **Disponibiliza√ß√£o de Categoria**
  
  Ap√≥s cria√ß√£o/edi√ß√£o:
  
  - Categoria fica imediatamente dispon√≠vel
    para uso em transa√ß√µes
  - Aparece na lista de categorias
  - Pode ser selecionada em formul√°rios
    de transa√ß√£o
  - Hist√≥rico √© mantido para transa√ß√µes
    anteriores
end note

@enduml

